# 网络

## 基础部分

#### TCP/IP 网络模型有哪几层？

1. **应用层（Application Layer）**

   - 主需要专注于为用户提供应用功能，比如HTTP、FTP、Telnet、DNS、SMTP等。
     - **HTTP**：超文本传输协议，用于在网络上从服务器传输超文本到本地浏览器，让用户能浏览网页获取各种信息。
     - **FTP**：文件传输协议，主要用于在网络上的不同主机之间进行文件的上传和下载操作。
     - **Telnet**：远程登录协议，允许用户通过网络远程连接到其他计算机并使用其资源，进行命令输入和操作。
     - **DNS**：域名系统，它的作用是将人类易记的域名转换为计算机可识别的 IP 地址，实现网络设备之间的准确通信。
     - **SMTP**：简单邮件传输协议，负责将电子邮件从发件人的邮件服务器发送到收件人的邮件服务器，实现邮件的发送功能。

2. **传输层（Transport Layer）**

   - 应用层的数据包会传给传输层，传输层是为应用层提供网络支持的。

     在传输层的两个传输协议——TCP和UDP。

     - **TCP**：传输控制协议（Transmission Control Protocol），大部分应用使用的是TCP传输层协议，比如HTTP应用层协议。TCP相比UDP多了很多特性，比如流量控制、超时重传、拥塞控制等，这些都是为了保证数据包能可靠地传输给对方。
     - **UDP**：只负责发送数据包，不保证数据包是否能抵达对方，但它实时性相对更好，传输效率也高。当把TCP的特性在应用层实现的时候就可以实现UDP的可靠传输，但是并不简单。

   - 应用需要传输的数据非常大时，直接传输不好控制，因此当传输层的数据包大小超过MSS（TCP最大报文段长度），就要将数据包分块，这样即使中途有一个分块丢失或损坏了，只需要重新发送这一个分块，而不用重新发送整个数据包。在TCP协议中，把每个分块成为一个**TCP段**（TCP Segment）。


   - 当设备作为接收方时，传输层则要负责把数据包传给应用，但是一台设备上可能会有很多应用在接收或者传输数据，因此需要用一个编号将应用区分开来，这个编号就是**端口**。
   - 传输层的设计理念：简单、高校、专注。

3. **网络层（Internet Layer）**

   - 网络层最常用的是IP协议（Internet Protocol），IP协议会将传输层的报文作为数据部分，再加上IP包头组装成IP报文，如果IP报文大小超过MTU（以太网中一般为1500字节）就会**再次进行分片**，得到一个即将发送到网络的IP报文。

   - 网络层负责将数据从一个设备传输到另一个设备，用IP地址给设备进行编码，对于IPv4协议，IP地址共32位，分成了四段（比如：192.168.100.1），每段是8位。

     - IP地址的意义——**网络号**：负责标识该IP地址是属于哪个子网的。
     - IP地址的意义——**主机号**：负责标识同一子网下的不同主机。

   - 配合子网掩码计算IP地址的网络号和主机号。

     比如 10.100.122.0/24，后面的/24表示就是255.255.255.0子网掩码，255.255.255.0二进制是[11111111-11111111-11111111-00000000]，24个1，为了简化子网掩码的表示。

     将10.100.122.2和255.255.255.0进行**按位与运算**，得到网络号：

     <u>0 0 0 0 1 0 1 0</u>  <u>0 1 1 0 0 1 0 0</u>  <u>0 1 1 1 1 0 1 0</u>  <u>0 0 0 0 0 0 1 0</u>

     <u>1 1 1 1 1 1 1 1</u>  <u>1 1 1 1 1 1 1 1</u>  <u>1 1 1 1 1 1 1 1</u>  <u>0 0 0 0 0 0 0 0</u>

     => <u>0 0 0 0 1 0 1 0</u>  <u>0 1 1 0 0 1 0 0</u>  <u>0 1 1 1 1 0 1 0</u>  <u>0 0 0 0 0 0 0 0</u>  => 10.100.122.0

     将255.255.255.0取反后与IP地址进行**按位与运算**，得到主机号：

     <u>0 0 0 0 1 0 1 0</u>  <u>0 1 1 0 0 1 0 0</u>  <u>0 1 1 1 1 0 1 0</u>  <u>0 0 0 0 0 0 1 0</u>

     <u>0 0 0 0 0 0 0 0</u>  <u>0 0 0 0 0 0 0 0</u>  <u>0 0 0 0 0 0 0 0</u>  <u>1 1 1 1 1 1 1 1</u>

     => <u>0 0 0 0 0 0 0 0</u>  <u>0 0 0 0 0 0 0 0</u>  <u>0 0 0 0 0 0 0 0</u>  <u>0 0 0 0 0 0 1 0</u> => 0.0.0.2

     在寻址的过程中，先匹配到相同的网络号（表示要找到 同一个子网），才会去找对应的主机。

   - IP协议另一重要能力——**路由**：两台设备是通过很多网关、路由器、交换机等众多网络设备连接起来的，当数据包到达一个网络节点，需要路由算法决定下一步走哪条路径。路由器寻址工作中，就是要找到目标地址的子网，进而把数据包转发给对应的网格内。

4. **网络接口层（Link Layer）**

   - 生成了IP头部之后，网络接口层在IP头部的前面加上MAC头部，并封装成数据帧（Data Frame）发送到网络上。

   - IP头部中的接收方IP地址表示网络包的目的地，通过这个地址我们就可以判断要将包发到哪里，但在以太网的世界中这个思路不行。

     以太网： 一种在局域网内，把附近的设备连接起来，使它们之间可以进行通讯的技术。

     以太网在判断网络包目的地时和IP的方式不同，因此必须采用相同匹配的方式才能在以太网中将包发往目的地，MAC头部就是干这个用的，因此在以太网进行通讯要用到MAC地址。包含接收方和发送方的MAC地址等信息，可以通过ARP协议获取对方的MAC地址。

传输单位——数据包

- 网络接口层：帧（frame）
- IP层：包（packet）
- TCP层：段（segment）
- HTTP：消息或报文（message）

















